Next3 INDEX

What is Next3?
Next3 is a clone of the Ext3 file system with the addition of snapshot support

What is this file?
this INDEX file serves as a cross reference to the next3 snapshot code.
it aims to help developers follow the changes from ext3 to next3
by dividing them into categories and sub categories.

Next3 patches:

next3_fs.patch - adds the next3 file system to the kernel
e2fsprogs_snapshot.patch - adds snapshot awareness to e2fsck resize2fs tune2fs lsattr and chattr
next3_snapshot.patch - adds snapshot support to a fresh ext3 clone (see following files list)


Next3 files:

Changed kernel files:
fs/Kconfig - add generic snapshot and next3
fs/Makefile - add generic snapshot and next3
fs/buffer.c - tracked read functions
include/linux/buffer_head.h - tracked read macros
include/linux/journal_head.h - add COW tid cache to journal_head
include/linux/jbd.h - add recursion level to handle_t
include/linux/magic.h - add next3 file system

Added ext3 files:
fs/next3/snapshot.h - next3 snapshot API
fs/next3/snapshot.c - next3 snapshot core functions
fs/next3/snapshot_ctl.c - next3 snapshot control functions
fs/next3/snapshot_debug.h - next3 snapshot debug macros
fs/next3/snapshot_debug.c - next3 snapshot debugfs

Changed ext3 files:
fs/next3/Kconfig - add next3 snapshot support
fs/next3/Makefile - add next3 snapshot support
fs/next3/balloc.c - snapshot delete block hooks
fs/next3/file.c - snapshot file access permissions
fs/next3/inode.c - snapshot inode special behavior and data write hooks
fs/next3/ioctl.c - next3 snapshot control via chattr
fs/next3/namei.c - generalized inode list functions
fs/next3/super.c - initialize snapshot code
fs/next3/next3_jbd.c - snapshot meta data write hooks
include/linux/next3_jbd.h - snapshot meta data write hooks
include/linux/next3.h - add snapshot fields to next3 on-disk structs
include/linux/next3_sb.h - add snapshot fields to next3 in-memory structs


Next3 patch categories:

all changes to ext3 files in next3_snapshot.patch are ifdef'ed 
with one of the macros defined in fs/next3/Kconfig.
each macro is associated with one of the main patch categories.
in addition the that a macro may define a sub patch category.



CONFIG_NEXT3_FS_SNAPSHOT patch categories:

CONFIG_NEXT3_FS_SNAPSHOT_HOOKS - Next3 Snapshot Hooks 
CONFIG_NEXT3_FS_SNAPSHOT_FILE - Next3 Snapshot File 
CONFIG_NEXT3_FS_SNAPSHOT_BALLOC - Next3 Snapshot Block Allocator 
CONFIG_NEXT3_FS_SNAPSHOT_JOURNAL - Next3 Snapshot Journalled 
CONFIG_NEXT3_FS_SNAPSHOT_LIST - Next3 Snapshot List 
CONFIG_NEXT3_FS_SNAPSHOT_CTL - Next3 Snapshot Control 
CONFIG_NEXT3_FS_SNAPSHOT_RACE - Next3 Snapshot Race Conditions 
CONFIG_NEXT3_FS_SNAPSHOT_EXCLUDE - Next3 Snapshot Exclude 
CONFIG_NEXT3_FS_SNAPSHOT_DEBUG - Next3 snapshot debugging support 

Number of patch hunks per category/file:

CONFIG_NEXT3_FS_SNAPSHOT, _HOOKS*, _FILE*, _BALLOC*, _JOURNAL*, _LIST*, _CTL*, _RACE*, _EXCLUDE*, _DEBUG*, *
fs/next3/balloc.c, 5, 0, 5, 2, 0, 0, 0, 0, 0, 12
fs/next3/file.c, 0, 2, 0, 0, 0, 0, 0, 0, 0, 2
fs/next3/ialloc.c, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1
fs/next3/inode.c, 11, 38, 1, 10, 3, 0, 9, 0, 1, 73
fs/next3/ioctl.c, 0, 0, 0, 0, 0, 4, 0, 0, 0, 4
fs/next3/Makefile, 0, 0, 0, 0, 0, 0, 0, 0, 1, 3
fs/next3/namei.c, 0, 1, 0, 5, 6, 0, 0, 0, 0, 12
fs/next3/next3.h, 1, 6, 0, 0, 0, 0, 0, 4, 1, 16
fs/next3/next3_jbd.c, 4, 0, 0, 8, 0, 0, 0, 0, 0, 12
fs/next3/next3_jbd.h, 2, 0, 0, 5, 0, 0, 0, 0, 0, 7
fs/next3/next3_sb.h, 0, 2, 0, 0, 1, 0, 0, 0, 0, 3
fs/next3/resize.c, 1, 0, 0, 2, 0, 0, 0, 0, 0, 3
fs/next3/snapshot.c, 0, 7, 4, 15, 0, 0, 5, 2, 2, 35
fs/next3/snapshot_ctl.c, 0, 16, 7, 0, 12, 1, 0, 0, 4, 40
fs/next3/snapshot_debug.h, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1
fs/next3/snapshot.h, 3, 7, 2, 0, 0, 1, 0, 2, 2, 17
fs/next3/super.c, 0, 1, 2, 5, 1, 0, 0, 0, 0, 13
fs/next3/xattr.c, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1
include/linux/jbd.h, 0, 1, 0, 2, 0, 0, 0, 0, 0, 3
include/linux/journal-head.h, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1
Total, 27, 81, 21, 57, 23, 6, 14, 8, 12, 259


CONFIG_NEXT3_FS_SNAPSHOT_HOOKS patch categories:

CONFIG_NEXT3_FS_SNAPSHOT_HOOKS_JBD - Next3 Snapshot Hooks - inside JBD hooks 
CONFIG_NEXT3_FS_SNAPSHOT_HOOKS_INODE - Next3 Snapshot Hooks - Inode argument 
CONFIG_NEXT3_FS_SNAPSHOT_HOOKS_MOVE - Next3 Snapshot Hooks - Move data blocks 
CONFIG_NEXT3_FS_SNAPSHOT_HOOKS_DELETE - Next3 Snapshot Hooks - Delete blocks 

Number of patch hunks per category/file:

CONFIG_NEXT3_FS_SNAPSHOT_HOOKS, _JBD, _INODE, _MOVE, _DELETE, , *
fs/next3/balloc.c, 0, 0, 0, 5, 0, 5
fs/next3/inode.c, 0, 4, 7, 0, 0, 11
fs/next3/next3.h, 0, 0, 0, 1, 0, 1
fs/next3/next3_jbd.c, 3, 1, 0, 0, 0, 4
fs/next3/next3_jbd.h, 0, 2, 0, 0, 0, 2
fs/next3/resize.c, 1, 0, 0, 0, 0, 1
fs/next3/snapshot.h, 0, 0, 2, 0, 1, 3
Total, 4, 7, 9, 6, 1, 27


CONFIG_NEXT3_FS_SNAPSHOT_FILE patch categories:

CONFIG_NEXT3_FS_SNAPSHOT_FILE_PEEP - Next3 Snapshot File - Peep through to block device 
CONFIG_NEXT3_FS_SNAPSHOT_FILE_MOVE - Next3 Snapshot File - Move blocks into 
CONFIG_NEXT3_FS_SNAPSHOT_FILE_EXCLUDE - Next3 Snapshot File - Exclude from snapshot 
CONFIG_NEXT3_FS_SNAPSHOT_FILE_SHRINK - Next3 Snapshot File - Shrink deleted snapshots 
CONFIG_NEXT3_FS_SNAPSHOT_FILE_MERGE - Next3 Snapshot File - Merge shrinked snapshots 
CONFIG_NEXT3_FS_SNAPSHOT_FILE_PERM - Next3 Snapshot File - Permissions 
CONFIG_NEXT3_FS_SNAPSHOT_FILE_STORE - Next3 Snapshot File - Store on disk 

Number of patch hunks per category/file:

CONFIG_NEXT3_FS_SNAPSHOT_FILE, _PEEP, _MOVE, _EXCLUDE, _SHRINK, _MERGE, _PERM, _STORE, , *
fs/next3/file.c, 0, 0, 0, 0, 0, 2, 0, 0, 2
fs/next3/inode.c, 2, 9, 14, 6, 1, 1, 2, 3, 38
fs/next3/namei.c, 0, 0, 0, 0, 0, 1, 0, 0, 1
fs/next3/next3.h, 0, 0, 0, 0, 0, 0, 4, 2, 6
fs/next3/next3_sb.h, 0, 0, 0, 0, 0, 0, 0, 2, 2
fs/next3/snapshot.c, 0, 4, 2, 1, 0, 0, 0, 0, 7
fs/next3/snapshot_ctl.c, 0, 0, 8, 4, 4, 0, 0, 0, 16
fs/next3/snapshot.h, 0, 0, 4, 0, 1, 0, 0, 2, 7
fs/next3/super.c, 0, 0, 0, 0, 0, 0, 0, 1, 1
include/linux/jbd.h, 0, 0, 0, 0, 0, 0, 0, 1, 1
Total, 2, 13, 28, 11, 6, 4, 6, 11, 81


CONFIG_NEXT3_FS_SNAPSHOT_BALLOC patch categories:

CONFIG_NEXT3_FS_SNAPSHOT_BALLOC_RESERVE - Next3 Snapshot Block Allocator - reserve disk space for snapshot 
CONFIG_NEXT3_FS_SNAPSHOT_BALLOC_GOAL - Next3 Snapshot Block Allocator - allocation Goal 
CONFIG_NEXT3_FS_SNAPSHOT_BALLOC_SAFE - Next3 Snapshot Block Allocator - avoid COW bitmap conflicts 

Number of patch hunks per category/file:

CONFIG_NEXT3_FS_SNAPSHOT_BALLOC, _RESERVE, _GOAL, _SAFE, , *
fs/next3/balloc.c, 2, 0, 3, 0, 5
fs/next3/inode.c, 0, 1, 0, 0, 1
fs/next3/snapshot.c, 0, 0, 4, 0, 4
fs/next3/snapshot_ctl.c, 3, 2, 2, 0, 7
fs/next3/snapshot.h, 1, 0, 1, 0, 2
fs/next3/super.c, 2, 0, 0, 0, 2
Total, 8, 3, 10, 0, 21


CONFIG_NEXT3_FS_SNAPSHOT_JOURNAL patch categories:

CONFIG_NEXT3_FS_SNAPSHOT_JOURNAL_CREDITS - Next3 Snapshot Journalled - increase transaction credits 
CONFIG_NEXT3_FS_SNAPSHOT_JOURNAL_RELEASE - Next3 Snapshot Journalled - implement journal_release_buffer() 
CONFIG_NEXT3_FS_SNAPSHOT_JOURNAL_BYPASS - Next3 Snapshot Journalled - bypass to save credits 
CONFIG_NEXT3_FS_SNAPSHOT_JOURNAL_ERROR - Next3 Snapshot Journalled - record journal error 
CONFIG_NEXT3_FS_SNAPSHOT_JOURNAL_CACHE - Next3 Snapshot Journalled - cache last COW tid in journal_head 
CONFIG_NEXT3_FS_SNAPSHOT_JOURNAL_TRACE - Next3 Snapshot Journalled - trace COW/buffer credits 

Number of patch hunks per category/file:

CONFIG_NEXT3_FS_SNAPSHOT_JOURNAL, _CREDITS, _RELEASE, _BYPASS, _ERROR, _CACHE, _TRACE, , *
fs/next3/balloc.c, 0, 0, 0, 2, 0, 0, 0, 2
fs/next3/ialloc.c, 0, 1, 0, 0, 0, 0, 0, 1
fs/next3/inode.c, 1, 0, 4, 5, 0, 0, 0, 10
fs/next3/namei.c, 0, 0, 0, 5, 0, 0, 0, 5
fs/next3/next3_jbd.c, 0, 1, 0, 0, 0, 7, 0, 8
fs/next3/next3_jbd.h, 3, 1, 0, 0, 0, 1, 0, 5
fs/next3/resize.c, 2, 0, 0, 0, 0, 0, 0, 2
fs/next3/snapshot.c, 5, 0, 0, 0, 2, 8, 0, 15
fs/next3/super.c, 2, 0, 0, 2, 0, 1, 0, 5
fs/next3/xattr.c, 0, 1, 0, 0, 0, 0, 0, 1
include/linux/jbd.h, 1, 0, 0, 0, 0, 1, 0, 2
include/linux/journal-head.h, 0, 0, 0, 0, 1, 0, 0, 1
Total, 14, 4, 4, 14, 3, 18, 0, 57


CONFIG_NEXT3_FS_SNAPSHOT_LIST patch categories:

CONFIG_NEXT3_FS_SNAPSHOT_LIST_PEEP - Next3 Snapshot List - Peep through to previous snapshot 
CONFIG_NEXT3_FS_SNAPSHOT_LIST_ORPHAN - Next3 Snapshot List - use Orphan list functions 

Number of patch hunks per category/file:

CONFIG_NEXT3_FS_SNAPSHOT_LIST, _PEEP, _ORPHAN, , *
fs/next3/inode.c, 3, 0, 0, 3
fs/next3/namei.c, 0, 6, 0, 6
fs/next3/next3_sb.h, 0, 0, 1, 1
fs/next3/snapshot_ctl.c, 0, 0, 12, 12
fs/next3/super.c, 0, 0, 1, 1
Total, 3, 6, 14, 23


CONFIG_NEXT3_FS_SNAPSHOT_CTL patch categories:


Number of patch hunks per category/file:

CONFIG_NEXT3_FS_SNAPSHOT_CTL, , *
fs/next3/ioctl.c, 4, 4
fs/next3/snapshot_ctl.c, 1, 1
fs/next3/snapshot.h, 1, 1
Total, 6, 6


CONFIG_NEXT3_FS_SNAPSHOT_RACE patch categories:

CONFIG_NEXT3_FS_SNAPSHOT_RACE_COW - Next3 Snapshot Race Conditions - concurrent COW operations 
CONFIG_NEXT3_FS_SNAPSHOT_RACE_READ - Next3 Snapshot Race Conditions - tracked reads 
CONFIG_NEXT3_FS_SNAPSHOT_RACE_BITMAP - Next3 Snapshot Race Conditions - concurrent COW bitmap operations 

Number of patch hunks per category/file:

CONFIG_NEXT3_FS_SNAPSHOT_RACE, _COW, _READ, _BITMAP, , *
fs/next3/inode.c, 4, 5, 0, 0, 9
fs/next3/snapshot.c, 3, 1, 1, 0, 5
Total, 7, 6, 1, 0, 14


CONFIG_NEXT3_FS_SNAPSHOT_EXCLUDE patch categories:

CONFIG_NEXT3_FS_SNAPSHOT_EXCLUDE_BITMAP - Next3 Snapshot Exclude - the exclude bitmap 
CONFIG_NEXT3_FS_SNAPSHOT_EXCLUDE_INODE - Next3 Snapshot Exclude - the exclude inode 
CONFIG_NEXT3_FS_SNAPSHOT_EXCLUDE_FILES - Next3 Snapshot Exclude - regular files (experimental) 

Number of patch hunks per category/file:

CONFIG_NEXT3_FS_SNAPSHOT_EXCLUDE, _BITMAP, _INODE, _FILES, , *
fs/next3/next3.h, 0, 3, 1, 0, 4
fs/next3/snapshot.c, 0, 0, 2, 0, 2
fs/next3/snapshot.h, 0, 0, 1, 1, 2
Total, 0, 3, 4, 1, 8


CONFIG_NEXT3_FS_SNAPSHOT_DEBUG patch categories:


Number of patch hunks per category/file:

CONFIG_NEXT3_FS_SNAPSHOT_DEBUG, , *
fs/next3/inode.c, 1, 1
fs/next3/Makefile, 1, 1
fs/next3/next3.h, 1, 1
fs/next3/snapshot.c, 2, 2
fs/next3/snapshot_ctl.c, 4, 4
fs/next3/snapshot_debug.h, 1, 1
fs/next3/snapshot.h, 2, 2
Total, 12, 12

